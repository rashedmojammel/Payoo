<!doctype html>
<html data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/daisyui@5" rel="stylesheet" type="text/css" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" />
    <title>Payoo | Home</title>
    <link rel="shortcut icon" href="./assets/logo.png" type="image/x-icon">
    <style type="text/tailwindcss">
      * { font-family: "Outfit", sans-serif; }

      /* Fade-in for transaction cards */
      .animate-fade-in { animation: fadeIn 0.3s ease-in-out; }
      @keyframes fadeIn {
        from { opacity:0; transform:translateY(8px); }
        to   { opacity:1; transform:translateY(0); }
      }

      /* Confetti particle */
      .confetti-piece {
        position: fixed;
        width: 10px; height: 10px;
        top: -10px;
        border-radius: 2px;
        animation: confettiFall linear forwards;
        pointer-events: none;
        z-index: 9999;
      }
      @keyframes confettiFall {
        0%   { transform: translateY(0) rotate(0deg); opacity:1; }
        100% { transform: translateY(110vh) rotate(720deg); opacity:0; }
      }

      /* Pull-to-refresh spinner */
      #ptr-indicator {
        position: fixed; top: 70px; left: 50%; transform: translateX(-50%);
        z-index: 100; transition: opacity 0.3s;
      }
      #ptr-spinner {
        width: 36px; height: 36px; border-radius: 50%;
        border: 3px solid #e5e7eb;
        border-top-color: #3B25C1;
        animation: spin 0.7s linear infinite;
      }
      @keyframes spin { to { transform: rotate(360deg); } }

      /* Bottom nav active */
      .nav-item.active i, .nav-item.active p { color: #3B25C1 !important; }
      .nav-item.active { position: relative; }
      .nav-item.active::before {
        content:""; position:absolute; top:0; left:50%; transform:translateX(-50%);
        width: 36px; height: 3px; background: #3B25C1; border-radius: 0 0 4px 4px;
      }

      /* Section content bottom padding for nav */
      main { padding-bottom: 80px; }
    </style>
  </head>

  <body class="min-h-screen max-w-md bg-base-200 mx-auto">

    <!-- Pull-to-refresh indicator -->
    <div id="ptr-indicator" style="opacity:0; pointer-events:none;">
      <div id="ptr-spinner"></div>
    </div>

    <!-- Header -->
    <header class="border-b border-base-300 sticky top-0 bg-base-200 z-20">
      <section class="w-11/12 mx-auto py-3 flex justify-between items-center">
        <div class="flex gap-3 items-center">
          <div>
            <div class="text-xl font-black text-[#3B25C1] leading-none">Pay<span class="text-neutral">oo</span></div>
            <div class="flex items-center gap-1 mt-0.5">
              <p class="text-neutral/40 text-xs">Balance:</p>
              <h2 class="font-bold text-base leading-none">৳<span id="balance">45,000</span></h2>
            </div>
          </div>
        </div>
        <div class="flex items-center gap-1">
          <!-- Dark mode toggle -->
          <button id="theme-toggle" onclick="toggleTheme()" class="btn btn-ghost btn-sm rounded-xl" title="Toggle dark mode">
            <i id="theme-icon" class="fa-solid fa-moon text-lg"></i>
          </button>
          <!-- Notification bell -->
          <button onclick="setNav('history')" class="btn btn-ghost btn-sm rounded-xl relative">
            <i class="fa-solid fa-bell text-lg"></i>
            <span id="tx-badge" class="hidden absolute -top-0.5 -right-0.5 bg-red-500 text-white text-[10px] rounded-full w-4 h-4 flex items-center justify-center font-bold"></span>
          </button>
          <!-- Logout -->
          <button onclick="confirmLogout()" class="btn btn-ghost btn-sm rounded-xl" title="Logout">
            <i class="fa-solid fa-arrow-right-from-bracket text-lg"></i>
          </button>
        </div>
      </section>

      <!-- Spending limit bar -->
      <div id="limit-bar-wrap" class="hidden w-11/12 mx-auto pb-2">
        <div class="flex justify-between text-xs text-gray-400 mb-1">
          <span>Monthly Spend</span>
          <span id="limit-bar-label"></span>
        </div>
        <div class="w-full bg-base-300 rounded-full h-1.5">
          <div id="limit-bar" class="h-1.5 rounded-full transition-all duration-700 bg-[#3B25C1]" style="width:0%"></div>
        </div>
      </div>
    </header>

    <main id="main-content">

      <!-- ══ HOME ══ -->
      <section id="sec-home" class="w-11/12 mx-auto pt-5">
        <div class="space-y-1 mb-5">
          <h1 class="text-2xl font-bold">Welcome to Pay<span class="text-primary">oo</span></h1>
          <p class="text-neutral/40 text-sm">Easy and convenient financial services.</p>
        </div>

        <!-- Action Grid -->
        <div class="grid grid-cols-3 gap-3 mb-3">
          <button onclick="setNav('addMoney')" class="btn flex-col h-full py-4 btn-primary btn-soft rounded-2xl gap-1">
            <img src="./assets/opt-1.png" class="w-9">
            <p class="text-neutral/70 text-xs">Add Money</p>
          </button>
          <button onclick="setNav('cashout')" class="btn flex-col h-full py-4 btn-primary btn-soft rounded-2xl gap-1">
            <img src="./assets/opt-2.png" class="w-9">
            <p class="text-neutral/70 text-xs">Cashout</p>
          </button>
          <button onclick="setNav('send')" class="btn flex-col h-full py-4 btn-primary btn-soft rounded-2xl gap-1">
            <img src="./assets/opt-3.png" class="w-9">
            <p class="text-neutral/70 text-xs">Send Money</p>
          </button>
          <button onclick="setNav('bonus')" class="btn flex-col h-full py-4 btn-primary btn-soft rounded-2xl gap-1">
            <img src="./assets/opt-4.png" class="w-9">
            <p class="text-neutral/70 text-xs">Get Bonus</p>
          </button>
          <button onclick="setNav('paybill')" class="btn flex-col h-full py-4 btn-primary btn-soft rounded-2xl gap-1">
            <img src="./assets/opt-5.png" class="w-9">
            <p class="text-neutral/70 text-xs">Pay Bill</p>
          </button>
          <button onclick="setNav('contacts')" class="btn flex-col h-full py-4 btn-primary btn-soft rounded-2xl gap-1">
            <i class="fa-solid fa-star text-2xl text-yellow-400"></i>
            <p class="text-neutral/70 text-xs">Contacts</p>
          </button>
        </div>
        <button onclick="setNav('dashboard')" class="btn btn-primary btn-soft rounded-2xl w-full gap-2 mb-3">
          <i class="fa-solid fa-chart-line"></i> Spending Dashboard
        </button>
        <button onclick="setNav('settings')" class="btn btn-ghost rounded-2xl w-full gap-2 border border-base-300">
          <i class="fa-solid fa-sliders"></i> Settings & Spending Limit
        </button>
      </section>

      <!-- ── Add Money ── -->
      <section id="sec-addMoney" class="hidden w-11/12 mx-auto py-5">
        <h1 class="font-bold text-2xl mb-4">Add Money</h1>
        <div class="card bg-base-100 rounded-2xl">
          <div class="card-body gap-3">
            <div>
              <label class="label font-semibold text-sm">Select a Bank</label>
              <select id="addmoney-bank" class="select rounded-2xl bg-base-200 w-full h-12">
                <option disabled selected>Select Bank</option>
                <option value="DBBL">DBBL</option>
                <option value="IBBL">IBBL</option>
                <option value="CITY">City Bank</option>
              </select>
            </div>
            <div>
              <label class="label font-semibold text-sm">Bank Account Number</label>
              <input id="addMoney-input" type="text" maxlength="11" class="input rounded-2xl bg-base-200 w-full h-12" placeholder="11-digit Account Number" />
            </div>
            <div>
              <label class="label font-semibold text-sm">Amount (BDT)</label>
              <input id="addMoney-amount" type="number" min="1" class="input rounded-2xl bg-base-200 w-full h-12" placeholder="Enter amount" />
            </div>
            <div>
              <label class="label font-semibold text-sm">4-Digit PIN</label>
              <input id="addMoney-pin" type="password" maxlength="4" class="input rounded-2xl bg-base-200 w-full h-12" placeholder="PIN" />
            </div>
            <button id="addMoney-btn" class="btn bg-[#3B25C1] text-white border-none rounded-2xl h-12 text-base font-semibold">
              <i class="fa-solid fa-plus mr-2"></i>Add Money
            </button>
          </div>
        </div>
      </section>

      <!-- ── Cash Out ── -->
      <section id="sec-cashout" class="hidden w-11/12 mx-auto py-5">
        <h1 class="font-bold text-2xl mb-4">Cash Out</h1>
        <div class="card bg-base-100 rounded-2xl">
          <div class="card-body gap-3">
            <div>
              <label class="label font-semibold text-sm">Agent Number</label>
              <input id="cashout-input" type="text" maxlength="11" class="input rounded-2xl bg-base-200 w-full h-12" placeholder="11-digit agent number" />
            </div>
            <div>
              <label class="label font-semibold text-sm">Amount (BDT)</label>
              <input id="cashout-amount" type="number" min="1" class="input rounded-2xl bg-base-200 w-full h-12" placeholder="Enter amount" />
            </div>
            <div>
              <label class="label font-semibold text-sm">4-Digit PIN</label>
              <input id="cashout-pin" type="password" maxlength="4" class="input rounded-2xl bg-base-200 w-full h-12" placeholder="PIN" />
            </div>
            <button id="cashout-btn" class="btn bg-[#3B25C1] text-white border-none rounded-2xl h-12 text-base font-semibold">
              <i class="fa-solid fa-money-bill-wave mr-2"></i>Withdraw
            </button>
          </div>
        </div>
      </section>

      <!-- ── Send Money ── -->
      <section id="sec-send" class="hidden w-11/12 mx-auto py-5">
        <h1 class="font-bold text-2xl mb-4">Send Money</h1>
        <!-- Saved contacts quick-pick -->
        <div id="send-contacts-row" class="mb-4 hidden">
          <p class="text-sm font-semibold text-neutral/60 mb-2">Quick Pick from Contacts</p>
          <div id="send-contacts-list" class="flex gap-2 overflow-x-auto pb-1"></div>
        </div>
        <div class="card bg-base-100 rounded-2xl">
          <div class="card-body gap-3">
            <div>
              <label class="label font-semibold text-sm">Recipient Number</label>
              <input id="Transfer-input" type="text" maxlength="11" class="input rounded-2xl bg-base-200 w-full h-12" placeholder="11-digit number" />
            </div>
            <div>
              <label class="label font-semibold text-sm">Amount (BDT)</label>
              <input id="Transfer-amount" type="number" min="1" class="input rounded-2xl bg-base-200 w-full h-12" placeholder="Enter amount" />
            </div>
            <div>
              <label class="label font-semibold text-sm">4-Digit PIN</label>
              <input id="Transfer-pin" type="password" maxlength="4" class="input rounded-2xl bg-base-200 w-full h-12" placeholder="PIN" />
            </div>
            <button id="Transfer-btn" class="btn bg-[#3B25C1] text-white border-none rounded-2xl h-12 text-base font-semibold">
              <i class="fa-solid fa-paper-plane mr-2"></i>Send Money
            </button>
          </div>
        </div>
      </section>

      <!-- ── Pay Bill ── -->
      <section id="sec-paybill" class="hidden w-11/12 mx-auto py-5">
        <h1 class="font-bold text-2xl mb-4">Pay Bill</h1>
        <div class="card bg-base-100 rounded-2xl">
          <div class="card-body gap-3">
            <div>
              <label class="label font-semibold text-sm">Select a Bank</label>
              <select id="paybill-bank" class="select rounded-2xl bg-base-200 w-full h-12">
                <option disabled selected>Select Bank</option>
                <option value="DBBL">DBBL</option>
                <option value="IBBL">IBBL</option>
                <option value="CITY">City Bank</option>
              </select>
            </div>
            <div>
              <label class="label font-semibold text-sm">Biller Account Number</label>
              <input id="paybill-input" type="text" maxlength="11" class="input rounded-2xl bg-base-200 w-full h-12" placeholder="11-digit Account Number" />
            </div>
            <div>
              <label class="label font-semibold text-sm">Amount (BDT)</label>
              <input id="paybill-amount" type="number" min="1" class="input rounded-2xl bg-base-200 w-full h-12" placeholder="Enter amount" />
            </div>
            <div>
              <label class="label font-semibold text-sm">4-Digit PIN</label>
              <input id="paybill-pin" type="password" maxlength="4" class="input rounded-2xl bg-base-200 w-full h-12" placeholder="PIN" />
            </div>
            <button id="paybill-btn" class="btn bg-[#3B25C1] text-white border-none rounded-2xl h-12 text-base font-semibold">
              <i class="fa-solid fa-file-invoice-dollar mr-2"></i>Pay Bill
            </button>
          </div>
        </div>
      </section>

      <!-- ── Get Bonus ── -->
      <section id="sec-bonus" class="hidden w-11/12 mx-auto py-5">
        <h1 class="font-bold text-2xl mb-4">Get Bonus</h1>
        <div class="card bg-base-100 rounded-2xl">
          <div class="card-body gap-3">
            <div>
              <label class="label font-semibold text-sm">Bonus Coupon Code</label>
              <input id="Bonus-input" type="text" class="input rounded-2xl bg-base-200 w-full h-12" placeholder="Enter coupon code" />
              <p class="text-xs text-gray-400 mt-1">Try: <span class="font-mono bg-base-200 px-1 rounded">rashed</span>, <span class="font-mono bg-base-200 px-1 rounded">Fatema</span>, <span class="font-mono bg-base-200 px-1 rounded">Mercy</span></p>
            </div>
            <button id="Bonus-btn" class="btn bg-[#3B25C1] text-white border-none rounded-2xl h-12 text-base font-semibold">
              <i class="fa-solid fa-gift mr-2"></i>Redeem Coupon
            </button>
          </div>
        </div>
      </section>

      <!-- ── Saved Contacts ── -->
      <section id="sec-contacts" class="hidden w-11/12 mx-auto py-5">
        <div class="flex justify-between items-center mb-4">
          <h1 class="font-bold text-2xl">Saved Contacts</h1>
        </div>
        <!-- Add contact form -->
        <div class="card bg-base-100 rounded-2xl mb-4">
          <div class="card-body gap-3">
            <p class="font-semibold text-sm">Add New Contact</p>
            <input id="contact-name" type="text" maxlength="30" class="input rounded-2xl bg-base-200 w-full h-11" placeholder="Contact name" />
            <input id="contact-number" type="text" maxlength="11" class="input rounded-2xl bg-base-200 w-full h-11" placeholder="11-digit number" />
            <button onclick="addContact()" class="btn bg-[#3B25C1] text-white border-none rounded-2xl h-11 font-semibold">
              <i class="fa-solid fa-user-plus mr-2"></i>Save Contact
            </button>
          </div>
        </div>
        <div id="contacts-list" class="space-y-3"></div>
      </section>

      <!-- ── Transactions ── -->
      <section id="sec-history" class="hidden w-11/12 mx-auto py-5">
        <div class="flex justify-between items-center mb-4">
          <h1 class="font-bold text-2xl">Transactions</h1>
          <div class="flex gap-2">
            <button onclick="exportCSV()" class="btn btn-sm btn-ghost text-green-600 rounded-xl" title="Export CSV">
              <i class="fa-solid fa-file-csv"></i>
            </button>
            <button onclick="clearTransactionHistory()" class="btn btn-sm btn-ghost text-red-400 rounded-xl">
              <i class="fa-solid fa-trash-can"></i>
            </button>
          </div>
        </div>
        <!-- Filter Tabs -->
        <div class="flex gap-2 mb-4">
          <button id="filter-all"    onclick="setFilter('all')"    class="btn btn-sm rounded-xl bg-[#3B25C1] text-white flex-1 border-none">All</button>
          <button id="filter-credit" onclick="setFilter('credit')" class="btn btn-sm rounded-xl bg-base-300 text-gray-500 flex-1 border-none">Credit</button>
          <button id="filter-debit"  onclick="setFilter('debit')"  class="btn btn-sm rounded-xl bg-base-300 text-gray-500 flex-1 border-none">Debit</button>
        </div>
        <div id="Transaction-history" class="space-y-3 pb-4"></div>
      </section>

      <!-- ── Dashboard ── -->
      <section id="sec-dashboard" class="hidden"></section>

      <!-- ── Settings ── -->
      <section id="sec-settings" class="hidden w-11/12 mx-auto py-5">
        <h1 class="font-bold text-2xl mb-5">Settings</h1>

        <!-- Spending Limit -->
        <div class="card bg-base-100 rounded-2xl mb-4">
          <div class="card-body gap-3">
            <p class="font-bold">Monthly Spending Limit</p>
            <p class="text-sm text-neutral/50">Get alerted when you're close to or exceed your limit.</p>
            <div class="flex gap-2">
              <input id="limit-input" type="number" min="0" class="input rounded-2xl bg-base-200 flex-1 h-11" placeholder="e.g. 10000" />
              <button onclick="saveSpendingLimit()" class="btn bg-[#3B25C1] text-white border-none rounded-2xl h-11 px-5 font-semibold">Save</button>
            </div>
            <div id="current-limit-display" class="text-sm text-neutral/50"></div>
          </div>
        </div>

        <!-- Dark Mode -->
        <div class="card bg-base-100 rounded-2xl mb-4">
          <div class="card-body flex-row items-center justify-between">
            <div>
              <p class="font-bold">Dark Mode</p>
              <p class="text-sm text-neutral/50">Toggle light / dark theme</p>
            </div>
            <input type="checkbox" id="dark-toggle-settings" class="toggle toggle-primary" onchange="toggleTheme()" />
          </div>
        </div>

        <!-- Export -->
        <div class="card bg-base-100 rounded-2xl">
          <div class="card-body gap-3">
            <p class="font-bold">Export Statement</p>
            <p class="text-sm text-neutral/50">Download all your transactions as a CSV file.</p>
            <button onclick="exportCSV()" class="btn bg-green-600 text-white border-none rounded-2xl h-11 font-semibold">
              <i class="fa-solid fa-file-csv mr-2"></i>Download CSV
            </button>
          </div>
        </div>
      </section>

    </main>

    <!-- Bottom Navigation Bar -->
    <nav class="fixed bottom-0 left-1/2 -translate-x-1/2 w-full max-w-md bg-base-100 border-t border-base-300 z-20">
      <div class="flex justify-around py-2">
        <button onclick="setNav('home')" id="nav-home" class="nav-item flex flex-col items-center gap-0.5 px-3 py-1 rounded-xl">
          <i class="fa-solid fa-house text-lg text-gray-400"></i>
          <p class="text-[10px] text-gray-400 font-medium">Home</p>
        </button>
        <button onclick="setNav('send')" id="nav-send" class="nav-item flex flex-col items-center gap-0.5 px-3 py-1 rounded-xl">
          <i class="fa-solid fa-paper-plane text-lg text-gray-400"></i>
          <p class="text-[10px] text-gray-400 font-medium">Send</p>
        </button>
        <button onclick="setNav('dashboard')" id="nav-dashboard" class="nav-item flex flex-col items-center gap-0.5 px-3 py-1 rounded-xl">
          <i class="fa-solid fa-chart-line text-lg text-gray-400"></i>
          <p class="text-[10px] text-gray-400 font-medium">Stats</p>
        </button>
        <button onclick="setNav('history')" id="nav-history" class="nav-item flex flex-col items-center gap-0.5 px-3 py-1 rounded-xl relative">
          <i class="fa-solid fa-clock-rotate-left text-lg text-gray-400"></i>
          <p class="text-[10px] text-gray-400 font-medium">History</p>
          <span id="tx-badge-nav" class="hidden absolute top-0 right-1 bg-red-500 text-white text-[9px] rounded-full w-4 h-4 flex items-center justify-center font-bold"></span>
        </button>
        <button onclick="setNav('settings')" id="nav-settings" class="nav-item flex flex-col items-center gap-0.5 px-3 py-1 rounded-xl">
          <i class="fa-solid fa-sliders text-lg text-gray-400"></i>
          <p class="text-[10px] text-gray-400 font-medium">Settings</p>
        </button>
      </div>
    </nav>

    <!-- Logout Modal -->
    <dialog id="logout-modal" class="modal">
      <div class="modal-box rounded-3xl">
        <h3 class="font-bold text-lg">Logout</h3>
        <p class="py-3 text-neutral/60">Are you sure you want to logout?</p>
        <div class="modal-action gap-3">
          <button onclick="document.getElementById('logout-modal').close()" class="btn rounded-2xl flex-1">Cancel</button>
          <button onclick="doLogout()" class="btn btn-error rounded-2xl flex-1 text-white">Logout</button>
        </div>
      </div>
    </dialog>

    <script>
      // Apply saved theme immediately
      (function() {
        var t = localStorage.getItem("payoo_theme") || "light";
        document.documentElement.setAttribute("data-theme", t);
        var icon = document.getElementById("theme-icon");
        var toggle = document.getElementById("dark-toggle-settings");
        if (t === "dark") { if(icon) icon.className = "fa-solid fa-sun text-lg"; if(toggle) toggle.checked = true; }
      })();

      function toggleTheme() {
        var current = document.documentElement.getAttribute("data-theme");
        var next = current === "dark" ? "light" : "dark";
        document.documentElement.setAttribute("data-theme", next);
        localStorage.setItem("payoo_theme", next);
        var icon = document.getElementById("theme-icon");
        var toggle = document.getElementById("dark-toggle-settings");
        if (next === "dark") { icon.className = "fa-solid fa-sun text-lg"; if(toggle) toggle.checked = true; }
        else { icon.className = "fa-solid fa-moon text-lg"; if(toggle) toggle.checked = false; }
      }

      function confirmLogout() { document.getElementById("logout-modal").showModal(); }
      function doLogout() { localStorage.removeItem("payoo_logged_in"); window.location.assign("./index.html"); }
      function clearTransactionHistory() {
        if (confirm("Clear all transaction history?")) {
          localStorage.removeItem("payoo_transactions");
          renderTransactionHistory("all");
          updateBadge();
        }
      }
    </script>

    <script src="./script/machine.js"></script>
    <script src="./script/addmoney.js"></script>
    <script src="./script/sendmoney.js"></script>
    <script src="./script/paybill.js"></script>
    <script src="./script/getbonus.js"></script>
    <script src="./script/cashout.js"></script>
  </body>
</html>